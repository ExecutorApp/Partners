import React, { useState, useEffect } from 'react';
import {
  View,
  Text,
  StyleSheet,
  SafeAreaView,
  TouchableOpacity,
  TextInput,
  ScrollView,
  StatusBar,
  Image,
  Platform,
} from 'react-native';

// Importações das imagens dos produtos
const holdingPatrimonialImage = require('../../../assets/00001.png');
const ativosFundiariosImage = require('../../../assets/00002.png');
const planejamentoTributarioImage = require('../../../assets/00003.png');
import { useNavigation } from '@react-navigation/native';
import { StackNavigationProp } from '@react-navigation/stack';
import { RootStackParamList, ScreenNames } from '../../types/navigation';
import Svg, { Path, Mask, Rect, Circle } from 'react-native-svg';
import ModalOrderingProducts from './2.ModalOrderingProducts';
import SideMenuScreen from '../5.Side Menu/1.SideMenuScreen';
// Importar os novos componentes
import Header from '../5.Side Menu/2.Header';
import BottomMenu from '../5.Side Menu/3.BottomMenu';
import { Layout } from '../../constants/theme';
import { 
  useFonts,
  Inter_100Thin,
  Inter_200ExtraLight,
  Inter_300Light,
  Inter_400Regular,
  Inter_500Medium,
  Inter_600SemiBold,
  Inter_700Bold,
  Inter_800ExtraBold,
  Inter_900Black
} from '@expo-google-fonts/inter';
import { useModal } from '../../context/ModalContext';
import { checkIncompleteRegistration } from '../../utils/registrationGuard';

// Componente do ícone de Comissão
const ComissaoIcon = ({ size = 18, color = "#7D8592", strokeWidth = 0.15}) => (  
  
  <Svg width={size} height={size} viewBox="0 0 18 15" fill="none">
    <Mask id="path-1-outside-1_228_1427" maskUnits="userSpaceOnUse" x="-0.849976" y="-0.850098" width="19" height="16" fill="black">
      <Rect fill="white" x="-0.849976" y="-0.850098" width="26" height="22"/>
      <Path d="M5.04281 4.24812C4.98892 4.24812 4.93724 4.26919 4.89914 4.30668C4.86103 4.34417 4.83963 4.39502 4.83963 4.44805C4.83963 4.51511 4.8262 4.58152 4.80012 4.64348C4.77404 4.70543 4.73581 4.76173 4.68762 4.80915C4.63942 4.85657 4.58221 4.89419 4.51924 4.91985C4.45627 4.94552 4.38879 4.95873 4.32063 4.95873C4.25247 4.95873 4.18499 4.94552 4.12202 4.91985C4.05905 4.89419 4.00184 4.85657 3.95364 4.80915C3.90545 4.76173 3.86722 4.70543 3.84114 4.64348C3.81506 4.58152 3.80163 4.51511 3.80163 4.44805C3.80163 4.39502 3.78023 4.34417 3.74212 4.30668C3.70402 4.26919 3.65234 4.24812 3.59845 4.24812C3.54456 4.24812 3.49288 4.26919 3.45478 4.30668C3.41667 4.34417 3.39527 4.39502 3.39527 4.44805C3.39527 4.68954 3.49276 4.92113 3.6663 5.09189C3.83984 5.26265 4.07521 5.35858 4.32063 5.35858C4.56605 5.35858 4.80142 5.26265 4.97496 5.09189C5.1485 4.92113 5.24599 4.68954 5.24599 4.44805C5.24599 4.39502 5.22459 4.34417 5.18648 4.30668C5.14838 4.26919 5.0967 4.24812 5.04281 4.24812ZM10.873 6.76633C10.9087 6.76635 10.9437 6.75707 10.9746 6.73944C11.0694 6.68552 11.1676 6.63494 11.2669 6.58909C11.3146 6.56594 11.3512 6.52528 11.3688 6.47585C11.3864 6.42642 11.3836 6.37217 11.361 6.32476C11.3383 6.27736 11.2977 6.24058 11.2478 6.22234C11.1979 6.2041 11.1427 6.20585 11.0941 6.22722C10.9847 6.27787 10.8761 6.33385 10.7714 6.39326C10.7326 6.41525 10.7022 6.44925 10.6851 6.48996C10.6679 6.53067 10.6649 6.57582 10.6765 6.61839C10.6881 6.66096 10.7137 6.69855 10.7493 6.72533C10.7849 6.75211 10.8285 6.76657 10.8733 6.76646L10.873 6.76633ZM10.3653 7.16704C10.406 7.13228 10.431 7.08303 10.4348 7.03014C10.4386 6.97724 10.4209 6.92504 10.3855 6.885C10.3502 6.84496 10.3001 6.82037 10.2464 6.81665C10.1926 6.81292 10.1396 6.83036 10.0989 6.86512C9.84608 7.08122 9.6195 7.32534 9.42364 7.59262C9.16823 7.94104 8.96823 8.3257 8.83052 8.73337C8.8221 8.75828 8.81876 8.78458 8.82068 8.81077C8.82259 8.83696 8.82973 8.86252 8.84169 8.88599C8.85364 8.90946 8.87018 8.93039 8.89036 8.94757C8.91053 8.96476 8.93395 8.97786 8.95927 8.98614C8.98459 8.99442 9.01132 8.99771 9.03793 8.99582C9.06455 8.99394 9.09052 8.98691 9.11438 8.97515C9.13823 8.96338 9.1595 8.94711 9.17696 8.92726C9.19443 8.90741 9.20774 8.88437 9.21616 8.85945C9.34089 8.4903 9.52203 8.14199 9.75334 7.8265C9.93082 7.5842 10.1362 7.36292 10.3653 7.16704Z"/>
      <Path d="M13.6943 6.98711C13.7094 6.83317 13.7176 6.67799 13.7176 6.52342C13.7176 6.46151 13.716 6.40013 13.7136 6.33858C14.0649 6.30117 14.3898 6.13747 14.626 5.87885C14.8623 5.62024 14.9932 5.28492 14.9936 4.9372C14.9936 4.88418 14.9722 4.83333 14.9341 4.79583C14.896 4.75834 14.8443 4.73728 14.7904 4.73728C14.7365 4.73728 14.6849 4.75834 14.6467 4.79583C14.6086 4.83333 14.5872 4.88418 14.5872 4.9372C14.5869 5.18443 14.4945 5.42296 14.3275 5.60768C14.1605 5.79241 13.9305 5.91051 13.681 5.93966C13.3554 3.32396 10.8689 1.28315 7.85906 1.28315C7.496 1.28322 7.13349 1.31096 6.77478 1.36612C6.52421 0.992481 6.18339 0.685809 5.78283 0.47356C5.38227 0.26131 4.93447 0.150106 4.47952 0.149902C4.44775 0.149902 4.41642 0.157234 4.38804 0.171309C4.35967 0.185384 4.33505 0.20581 4.31616 0.230946C4.29727 0.256083 4.28463 0.285228 4.27926 0.316042C4.27389 0.346856 4.27594 0.37848 4.28524 0.408374L4.34772 0.609133C4.47654 1.02097 4.52469 1.45314 4.48961 1.88266C3.35863 2.32715 2.39846 3.11054 1.74511 4.12184L1.489 4.52002H0.77803C0.61151 4.5202 0.451863 4.58537 0.334125 4.70124C0.216387 4.81711 0.150177 4.97421 0.150024 5.13806V7.79195C0.150204 7.95578 0.216425 8.11286 0.334159 8.22871C0.451893 8.34457 0.611524 8.40973 0.77803 8.40992H1.50295C1.69887 8.7862 1.9447 9.13521 2.23401 9.4478C2.80997 10.0785 3.12707 10.8974 3.12368 11.7454C3.12391 11.9618 3.2114 12.1693 3.36694 12.3224C3.52248 12.4754 3.73337 12.5615 3.95334 12.5617H4.82463C5.0446 12.5615 5.2555 12.4754 5.41104 12.3224C5.56658 12.1693 5.65407 11.9618 5.65429 11.7454C5.65439 11.6349 5.69902 11.529 5.77838 11.4509C5.85774 11.3729 5.96535 11.3289 6.07759 11.3288H7.70376C7.816 11.3289 7.92361 11.3729 8.00297 11.4509C8.08234 11.529 8.12696 11.6349 8.12706 11.7454C8.12729 11.9618 8.21477 12.1693 8.37031 12.3224C8.52586 12.4754 8.73676 12.5615 8.95673 12.5617H10.4827C10.8285 13.0693 11.3005 13.4815 11.8539 13.759C12.4072 14.0366 13.0235 14.1703 13.6442 14.1474C14.2649 14.1245 14.8693 13.9459 15.4 13.6284C15.9307 13.3109 16.37 12.8651 16.6763 12.3335C16.9826 11.8018 17.1457 11.2019 17.1499 10.5908C17.1542 9.9797 16.9996 9.37766 16.7008 8.84191C16.4019 8.30616 15.9688 7.8545 15.4426 7.52986C14.9164 7.20522 14.3146 7.01839 13.6943 6.98711ZM8.95622 12.1616C8.84398 12.1615 8.73637 12.1176 8.65701 12.0395C8.57765 11.9614 8.53302 11.8555 8.53292 11.7451C8.53271 11.5286 8.44523 11.3211 8.28968 11.1681C8.13414 11.015 7.92323 10.9289 7.70326 10.9287H6.07728C5.85731 10.9289 5.64641 11.015 5.49086 11.1681C5.33531 11.3211 5.24783 11.5286 5.24762 11.7451C5.24752 11.8555 5.20289 11.9614 5.12353 12.0395C5.04417 12.1176 4.93656 12.1615 4.82432 12.1616H3.95324C3.84101 12.1615 3.7334 12.1176 3.65403 12.0395C3.57467 11.9614 3.53004 11.8555 3.52994 11.7451C3.53341 10.7982 3.17901 9.8838 2.5356 9.17964C2.24349 8.86484 2.0002 8.50935 1.81359 8.12466C1.79715 8.09039 1.77115 8.06142 1.73863 8.04114C1.7061 8.02085 1.66839 8.01007 1.62988 8.01007H0.77803C0.719261 8.01 0.662917 7.987 0.621365 7.94611C0.579812 7.90522 0.556445 7.84977 0.556391 7.79195V5.13806C0.556462 5.08025 0.579838 5.02482 0.621389 4.98394C0.662939 4.94306 0.719273 4.92007 0.77803 4.92001H1.60092C1.63519 4.92001 1.6689 4.91147 1.69892 4.89521C1.72894 4.87894 1.75429 4.85547 1.77261 4.82698L2.08856 4.33579C2.71622 3.3641 3.64808 2.61967 4.74349 2.21487C4.78031 2.20289 4.81288 2.18078 4.83735 2.15116C4.86181 2.12154 4.87715 2.08566 4.88155 2.04773C4.94002 1.55072 4.8982 1.04723 4.75849 0.566149C5.32793 0.634027 5.85246 0.904561 6.23316 1.32674C6.61386 1.74892 6.82444 2.29356 6.82517 2.85797C6.82517 2.91099 6.84657 2.96184 6.88468 2.99934C6.92278 3.03683 6.97446 3.0579 7.02835 3.0579C7.08224 3.0579 7.13392 3.03683 7.17202 2.99934C7.21013 2.96184 7.23153 2.91099 7.23153 2.85797C7.23177 2.4722 7.14769 2.0909 6.985 1.73992C7.27479 1.70232 7.56677 1.6834 7.85906 1.68327C10.8654 1.68327 13.3111 3.85467 13.3111 6.52368C13.3111 6.67927 13.3028 6.83475 13.2862 6.98948C12.6858 7.02516 12.1037 7.20663 11.592 7.51767C11.0803 7.82871 10.6548 8.25964 10.3537 8.77195C10.0525 9.28426 9.88503 9.86199 9.86617 10.4535C9.84731 11.0451 9.97766 11.632 10.2456 12.1619L8.95622 12.1616ZM13.507 13.751C12.867 13.751 12.2413 13.5643 11.7091 13.2143C11.1769 12.8644 10.7621 12.3671 10.5171 11.7852C10.2722 11.2034 10.2081 10.5631 10.333 9.94537C10.4578 9.32765 10.7661 8.76025 11.2187 8.31491C11.6713 7.86956 12.2479 7.56628 12.8757 7.44341C13.5035 7.32055 14.1542 7.38361 14.7455 7.62464C15.3369 7.86566 15.8423 8.27382 16.1979 8.79749C16.5535 9.32117 16.7433 9.93684 16.7433 10.5667C16.7423 11.4109 16.4011 12.2203 15.7944 12.8173C15.1876 13.4143 14.3651 13.7501 13.507 13.751Z"/>
      <Path d="M13.507 9.21076C13.6604 9.2109 13.8075 9.27091 13.916 9.37763C14.0244 9.48435 14.0854 9.62905 14.0856 9.77998C14.0856 9.833 14.107 9.88386 14.1451 9.92135C14.1832 9.95884 14.2349 9.97991 14.2888 9.97991C14.3426 9.97991 14.3943 9.95884 14.4324 9.92135C14.4705 9.88386 14.4919 9.833 14.4919 9.77998C14.4916 9.55776 14.4139 9.34237 14.2716 9.16979C14.1293 8.99721 13.9312 8.87789 13.7102 8.83176V8.58822C13.7102 8.5352 13.6888 8.48434 13.6507 8.44685C13.6126 8.40936 13.5609 8.38829 13.507 8.38829C13.4532 8.38829 13.4015 8.40936 13.3634 8.44685C13.3253 8.48434 13.3039 8.5352 13.3039 8.58822V8.83176C13.0656 8.88121 12.8544 9.01576 12.711 9.20943C12.5677 9.4031 12.5023 9.64217 12.5276 9.88049C12.5528 10.1188 12.6669 10.3395 12.8478 10.4999C13.0287 10.6603 13.2635 10.749 13.507 10.7491C13.6599 10.7492 13.8064 10.8089 13.9146 10.915C14.0229 11.0211 14.084 11.1651 14.0848 11.3154C14.0855 11.4658 14.0257 11.6103 13.9185 11.7175C13.8113 11.8246 13.6654 11.8857 13.5126 11.8873C13.5107 11.8873 13.5089 11.887 13.507 11.887C13.5052 11.887 13.5034 11.8872 13.5015 11.8873C13.3491 11.8857 13.2035 11.8251 13.0963 11.7186C12.989 11.6121 12.9288 11.4682 12.9286 11.3183C12.9286 11.2653 12.9071 11.2144 12.869 11.1769C12.8309 11.1394 12.7793 11.1184 12.7254 11.1184C12.6715 11.1184 12.6198 11.1394 12.5817 11.1769C12.5436 11.2144 12.5222 11.2653 12.5222 11.3183C12.5225 11.5405 12.6003 11.7559 12.7425 11.9285C12.8848 12.1011 13.0829 12.2204 13.3039 12.2665V12.5451C13.3039 12.5981 13.3253 12.6489 13.3634 12.6864C13.4015 12.7239 13.4532 12.745 13.507 12.745C13.5609 12.745 13.6126 12.7239 13.6507 12.6864C13.6888 12.6489 13.7102 12.5981 13.7102 12.5451V12.2665C13.9485 12.2171 14.1598 12.0826 14.3032 11.8889C14.4466 11.6952 14.512 11.4561 14.4867 11.2178C14.4614 10.9794 14.3473 10.7588 14.1664 10.5983C13.9855 10.4379 13.7506 10.3492 13.507 10.3492C13.3536 10.3492 13.2065 10.2892 13.098 10.1825C12.9895 10.0757 12.9286 9.93095 12.9286 9.77998C12.9286 9.62901 12.9895 9.48423 13.098 9.37748C13.2065 9.27073 13.3536 9.21076 13.507 9.21076Z" fill={color} stroke={color} strokeWidth={strokeWidth}/>
    </Mask>
    <Path d="M5.04281 4.24812C4.98892 4.24812 4.93724 4.26919 4.89914 4.30668C4.86103 4.34417 4.83963 4.39502 4.83963 4.44805C4.83963 4.51511 4.8262 4.58152 4.80012 4.64348C4.77404 4.70543 4.73581 4.76173 4.68762 4.80915C4.63942 4.85657 4.58221 4.89419 4.51924 4.91985C4.45627 4.94552 4.38879 4.95873 4.32063 4.95873C4.25247 4.95873 4.18499 4.94552 4.12202 4.91985C4.05905 4.89419 4.00184 4.85657 3.95364 4.80915C3.90545 4.76173 3.86722 4.70543 3.84114 4.64348C3.81506 4.58152 3.80163 4.51511 3.80163 4.44805C3.80163 4.39502 3.78023 4.34417 3.74212 4.30668C3.70402 4.26919 3.65234 4.24812 3.59845 4.24812C3.54456 4.24812 3.49288 4.26919 3.45478 4.30668C3.41667 4.34417 3.39527 4.39502 3.39527 4.44805C3.39527 4.68954 3.49276 4.92113 3.6663 5.09189C3.83984 5.26265 4.07521 5.35858 4.32063 5.35858C4.56605 5.35858 4.80142 5.26265 4.97496 5.09189C5.1485 4.92113 5.24599 4.68954 5.24599 4.44805C5.24599 4.39502 5.22459 4.34417 5.18648 4.30668C5.14838 4.26919 5.0967 4.24812 5.04281 4.24812ZM10.873 6.76633C10.9087 6.76635 10.9437 6.75707 10.9746 6.73944C11.0694 6.68552 11.1676 6.63494 11.2669 6.58909C11.3146 6.56594 11.3512 6.52528 11.3688 6.47585C11.3864 6.42642 11.3836 6.37217 11.361 6.32476C11.3383 6.27736 11.2977 6.24058 11.2478 6.22234C11.1979 6.2041 11.1427 6.20585 11.0941 6.22722C10.9847 6.27787 10.8761 6.33385 10.7714 6.39326C10.7326 6.41525 10.7022 6.44925 10.6851 6.48996C10.6679 6.53067 10.6649 6.57582 10.6765 6.61839C10.6881 6.66096 10.7137 6.69855 10.7493 6.72533C10.7849 6.75211 10.8285 6.76657 10.8733 6.76646L10.873 6.76633ZM10.3653 7.16704C10.406 7.13228 10.431 7.08303 10.4348 7.03014C10.4386 6.97724 10.4209 6.92504 10.3855 6.885C10.3502 6.84496 10.3001 6.82037 10.2464 6.81665C10.1926 6.81292 10.1396 6.83036 10.0989 6.86512C9.84608 7.08122 9.6195 7.32534 9.42364 7.59262C9.16823 7.94104 8.96823 8.3257 8.83052 8.73337C8.8221 8.75828 8.81876 8.78458 8.82068 8.81077C8.82259 8.83696 8.82973 8.86252 8.84169 8.88599C8.85364 8.90946 8.87018 8.93039 8.89036 8.94757C8.91053 8.96476 8.93395 8.97786 8.95927 8.98614C8.98459 8.99442 9.01132 8.99771 9.03793 8.99582C9.06455 8.99394 9.09052 8.98691 9.11438 8.97515C9.13823 8.96338 9.1595 8.94711 9.17696 8.92726C9.19443 8.90741 9.20774 8.88437 9.21616 8.85945C9.34089 8.4903 9.52203 8.14199 9.75334 7.8265C9.93082 7.5842 10.1362 7.36292 10.3653 7.16704Z" fill={color} stroke={color} strokeWidth={strokeWidth}/>
    <Path d="M13.6943 6.98711C13.7094 6.83317 13.7176 6.67799 13.7176 6.52342C13.7176 6.46151 13.716 6.40013 13.7136 6.33858C14.0649 6.30117 14.3898 6.13747 14.626 5.87885C14.8623 5.62024 14.9932 5.28492 14.9936 4.9372C14.9936 4.88418 14.9722 4.83333 14.9341 4.79583C14.896 4.75834 14.8443 4.73728 14.7904 4.73728C14.7365 4.73728 14.6849 4.75834 14.6467 4.79583C14.6086 4.83333 14.5872 4.88418 14.5872 4.9372C14.5869 5.18443 14.4945 5.42296 14.3275 5.60768C14.1605 5.79241 13.9305 5.91051 13.681 5.93966C13.3554 3.32396 10.8689 1.28315 7.85906 1.28315C7.496 1.28322 7.13349 1.31096 6.77478 1.36612C6.52421 0.992481 6.18339 0.685809 5.78283 0.47356C5.38227 0.26131 4.93447 0.150106 4.47952 0.149902C4.44775 0.149902 4.41642 0.157234 4.38804 0.171309C4.35967 0.185384 4.33505 0.20581 4.31616 0.230946C4.29727 0.256083 4.28463 0.285228 4.27926 0.316042C4.27389 0.346856 4.27594 0.37848 4.28524 0.408374L4.34772 0.609133C4.47654 1.02097 4.52469 1.45314 4.48961 1.88266C3.35863 2.32715 2.39846 3.11054 1.74511 4.12184L1.489 4.52002H0.77803C0.61151 4.5202 0.451863 4.58537 0.334125 4.70124C0.216387 4.81711 0.150177 4.97421 0.150024 5.13806V7.79195C0.150204 7.95578 0.216425 8.11286 0.334159 8.22871C0.451893 8.34457 0.611524 8.40973 0.77803 8.40992H1.50295C1.69887 8.7862 1.9447 9.13521 2.23401 9.4478C2.80997 10.0785 3.12707 10.8974 3.12368 11.7454C3.12391 11.9618 3.2114 12.1693 3.36694 12.3224C3.52248 12.4754 3.73337 12.5615 3.95334 12.5617H4.82463C5.0446 12.5615 5.2555 12.4754 5.41104 12.3224C5.56658 12.1693 5.65407 11.9618 5.65429 11.7454C5.65439 11.6349 5.69902 11.529 5.77838 11.4509C5.85774 11.3729 5.96535 11.3289 6.07759 11.3288H7.70376C7.816 11.3289 7.92361 11.3729 8.00297 11.4509C8.08234 11.529 8.12696 11.6349 8.12706 11.7454C8.12729 11.9618 8.21477 12.1693 8.37031 12.3224C8.52586 12.4754 8.73676 12.5615 8.95673 12.5617H10.4827C10.8285 13.0693 11.3005 13.4815 11.8539 13.759C12.4072 14.0366 13.0235 14.1703 13.6442 14.1474C14.2649 14.1245 14.8693 13.9459 15.4 13.6284C15.9307 13.3109 16.37 12.8651 16.6763 12.3335C16.9826 11.8018 17.1457 11.2019 17.1499 10.5908C17.1542 9.9797 16.9996 9.37766 16.7008 8.84191C16.4019 8.30616 15.9688 7.8545 15.4426 7.52986C14.9164 7.20522 14.3146 7.01839 13.6943 6.98711ZM8.95622 12.1616C8.84398 12.1615 8.73637 12.1176 8.65701 12.0395C8.57765 11.9614 8.53302 11.8555 8.53292 11.7451C8.53271 11.5286 8.44523 11.3211 8.28968 11.1681C8.13414 11.015 7.92323 10.9289 7.70326 10.9287H6.07728C5.85731 10.9289 5.64641 11.015 5.49086 11.1681C5.33531 11.3211 5.24783 11.5286 5.24762 11.7451C5.24752 11.8555 5.20289 11.9614 5.12353 12.0395C5.04417 12.1176 4.93656 12.1615 4.82432 12.1616H3.95324C3.84101 12.1615 3.7334 12.1176 3.65403 12.0395C3.57467 11.9614 3.53004 11.8555 3.52994 11.7451C3.53341 10.7982 3.17901 9.8838 2.5356 9.17964C2.24349 8.86484 2.0002 8.50935 1.81359 8.12466C1.79715 8.09039 1.77115 8.06142 1.73863 8.04114C1.7061 8.02085 1.66839 8.01007 1.62988 8.01007H0.77803C0.719261 8.01 0.662917 7.987 0.621365 7.94611C0.579812 7.90522 0.556445 7.84977 0.556391 7.79195V5.13806C0.556462 5.08025 0.579838 5.02482 0.621389 4.98394C0.662939 4.94306 0.719273 4.92007 0.77803 4.92001H1.60092C1.63519 4.92001 1.6689 4.91147 1.69892 4.89521C1.72894 4.87894 1.75429 4.85547 1.77261 4.82698L2.08856 4.33579C2.71622 3.3641 3.64808 2.61967 4.74349 2.21487C4.78031 2.20289 4.81288 2.18078 4.83735 2.15116C4.86181 2.12154 4.87715 2.08566 4.88155 2.04773C4.94002 1.55072 4.8982 1.04723 4.75849 0.566149C5.32793 0.634027 5.85246 0.904561 6.23316 1.32674C6.61386 1.74892 6.82444 2.29356 6.82517 2.85797C6.82517 2.91099 6.84657 2.96184 6.88468 2.99934C6.92278 3.03683 6.97446 3.0579 7.02835 3.0579C7.08224 3.0579 7.13392 3.03683 7.17202 2.99934C7.21013 2.96184 7.23153 2.91099 7.23153 2.85797C7.23177 2.4722 7.14769 2.0909 6.985 1.73992C7.27479 1.70232 7.56677 1.6834 7.85906 1.68327C10.8654 1.68327 13.3111 3.85467 13.3111 6.52368C13.3111 6.67927 13.3028 6.83475 13.2862 6.98948C12.6858 7.02516 12.1037 7.20663 11.592 7.51767C11.0803 7.82871 10.6548 8.25964 10.3537 8.77195C10.0525 9.28426 9.88503 9.86199 9.86617 10.4535C9.84731 11.0451 9.97766 11.632 10.2456 12.1619L8.95622 12.1616ZM13.507 13.751C12.867 13.751 12.2413 13.5643 11.7091 13.2143C11.1769 12.8644 10.7621 12.3671 10.5171 11.7852C10.2722 11.2034 10.2081 10.5631 10.333 9.94537C10.4578 9.32765 10.7661 8.76025 11.2187 8.31491C11.6713 7.86956 12.2479 7.56628 12.8757 7.44341C13.5035 7.32055 14.1542 7.38361 14.7455 7.62464C15.3369 7.86566 15.8423 8.27382 16.1979 8.79749C16.5535 9.32117 16.7433 9.93684 16.7433 10.5667C16.7423 11.4109 16.4011 12.2203 15.7944 12.8173C15.1876 13.4143 14.3651 13.7501 13.507 13.751Z" fill={color} stroke={color} strokeWidth={strokeWidth}/>
    <Path d="M13.507 9.21076C13.6604 9.2109 13.8075 9.27091 13.916 9.37763C14.0244 9.48435 14.0854 9.62905 14.0856 9.77998C14.0856 9.833 14.107 9.88386 14.1451 9.92135C14.1832 9.95884 14.2349 9.97991 14.2888 9.97991C14.3426 9.97991 14.3943 9.95884 14.4324 9.92135C14.4705 9.88386 14.4919 9.833 14.4919 9.77998C14.4916 9.55776 14.4139 9.34237 14.2716 9.16979C14.1293 8.99721 13.9312 8.87789 13.7102 8.83176V8.58822C13.7102 8.5352 13.6888 8.48434 13.6507 8.44685C13.6126 8.40936 13.5609 8.38829 13.507 8.38829C13.4532 8.38829 13.4015 8.40936 13.3634 8.44685C13.3253 8.48434 13.3039 8.5352 13.3039 8.58822V8.83176C13.0656 8.88121 12.8544 9.01576 12.711 9.20943C12.5677 9.4031 12.5023 9.64217 12.5276 9.88049C12.5528 10.1188 12.6669 10.3395 12.8478 10.4999C13.0287 10.6603 13.2635 10.749 13.507 10.7491C13.6599 10.7492 13.8064 10.8089 13.9146 10.915C14.0229 11.0211 14.084 11.1651 14.0848 11.3154C14.0855 11.4658 14.0257 11.6103 13.9185 11.7175C13.8113 11.8246 13.6654 11.8857 13.5126 11.8873C13.5107 11.8873 13.5089 11.887 13.507 11.887C13.5052 11.887 13.5034 11.8872 13.5015 11.8873C13.3491 11.8857 13.2035 11.8251 13.0963 11.7186C12.989 11.6121 12.9288 11.4682 12.9286 11.3183C12.9286 11.2653 12.9071 11.2144 12.869 11.1769C12.8309 11.1394 12.7793 11.1184 12.7254 11.1184C12.6715 11.1184 12.6198 11.1394 12.5817 11.1769C12.5436 11.2144 12.5222 11.2653 12.5222 11.3183C12.5225 11.5405 12.6003 11.7559 12.7425 11.9285C12.8848 12.1011 13.0829 12.2204 13.3039 12.2665V12.5451C13.3039 12.5981 13.3253 12.6489 13.3634 12.6864C13.4015 12.7239 13.4532 12.745 13.507 12.745C13.5609 12.745 13.6126 12.7239 13.6507 12.6864C13.6888 12.6489 13.7102 12.5981 13.7102 12.5451V12.2665C13.9485 12.2171 14.1598 12.0826 14.3032 11.8889C14.4466 11.6952 14.512 11.4561 14.4867 11.2178C14.4614 10.9794 14.3473 10.7588 14.1664 10.5983C13.9855 10.4379 13.7506 10.3492 13.507 10.3492C13.3536 10.3492 13.2065 10.2892 13.098 10.1825C12.9895 10.0757 12.9286 9.93095 12.9286 9.77998C12.9286 9.62901 12.9895 9.48423 13.098 9.37748C13.2065 9.27073 13.3536 9.21076 13.507 9.21076Z" fill={color} stroke={color} strokeWidth="0.15"/>
  </Svg>
);

// Componente do ícone de Ticket médio
const TicketMedioIcon = ({ size = 18, color = "#7D8592" }) => (
  <Svg width={size} height={size} viewBox="0 0 12 14" fill="none">
    <Path d="M6.47047 8.78711H5.67183C5.38141 8.78711 5.14618 8.55135 5.14618 8.26029C5.14618 7.96923 5.38141 7.73347 5.67183 7.73347H7.07744C7.26912 7.73347 7.42594 7.5763 7.42594 7.3842C7.42594 7.1921 7.26912 7.03493 7.07744 7.03493H6.4182V6.54886C6.4182 6.35676 6.26137 6.19958 6.0697 6.19958C5.87802 6.19958 5.7212 6.35676 5.7212 6.54886V7.03493H5.67183C4.99806 7.03493 4.44918 7.58503 4.44918 8.26029C4.44918 8.93555 4.99806 9.48565 5.67183 9.48565H6.47047C6.76089 9.48565 6.99613 9.72141 6.99613 10.0125C6.99613 10.3035 6.76089 10.5393 6.47047 10.5393H5.03872C4.84705 10.5393 4.69022 10.6965 4.69022 10.8886C4.69022 11.0807 4.84705 11.2378 5.03872 11.2378H5.7241V11.7356C5.7241 11.9277 5.88093 12.0848 6.0726 12.0848C6.26428 12.0848 6.4211 11.9277 6.4211 11.7356V11.2378H6.4879C7.15586 11.2291 7.69313 10.6819 7.69313 10.0125C7.69313 9.33721 7.14424 8.78711 6.47047 8.78711Z" fill={color}/>
    <Path d="M11.3088 7.99543C10.9429 7.15135 10.4376 6.33347 9.79864 5.56798C9.02614 4.63659 8.25653 4.01372 7.86447 3.72557L9.3456 0.972141C9.4182 0.835343 9.39497 0.666528 9.2817 0.558836C8.89835 0.183368 8.49177 0 8.03872 0C7.62343 0 7.24298 0.157173 6.91191 0.296881C6.65053 0.404574 6.40368 0.509356 6.20329 0.509356C6.1423 0.509356 6.09003 0.500624 6.03775 0.480249C5.34656 0.227027 4.8151 0.0698545 4.30106 0.0698545C3.65053 0.0698545 3.09584 0.331809 2.55276 0.890645C2.4395 1.00707 2.42207 1.19044 2.5121 1.32723L4.10939 3.74595C3.71442 4.03992 2.95934 4.65696 2.20135 5.56798C1.56534 6.33347 1.05712 7.15135 0.691191 7.99543C0.232333 9.0578 0 10.1667 0 11.2902C0 12.7834 1.21394 14 2.70378 14H9.29622C10.7861 14 12 12.7834 12 11.2902C12 10.1667 11.7677 9.0578 11.3088 7.99543ZM3.25557 1.1817C3.59245 0.890644 3.91481 0.762578 4.30106 0.762578C4.71346 0.762578 5.17812 0.902287 5.79671 1.13222C5.92449 1.17879 6.06099 1.20208 6.20039 1.20208C6.54017 1.20208 6.86544 1.06819 7.17619 0.937214C7.47531 0.812058 7.75992 0.692723 8.03582 0.692723C8.16941 0.692723 8.35818 0.716008 8.59632 0.884823L7.20232 3.48108H4.77444L3.25557 1.1817ZM9.29622 13.3015H2.70378C1.59729 13.3015 0.696999 12.3992 0.696999 11.2902C0.696999 9.42453 1.37948 7.65489 2.7212 6.03077C3.56922 5.00333 4.43175 4.3659 4.69313 4.17963H7.30106C7.56534 4.36299 8.42498 5.00333 9.27299 6.03077C10.6176 7.65489 11.2972 9.42162 11.2972 11.2902C11.303 12.3992 10.4027 13.3015 9.29622 13.3015Z" fill={color}/>
  </Svg>
);

// Componente do ícone de Tempo médio de fechamento
const TempoMedioIcon = ({ size = 18, color = "#7D8592" }) => (
  <Svg width={size} height={size} viewBox="0 0 11 15" fill="none">
    <Path d="M9.45349 0.050293C9.63733 0.0504608 9.81398 0.120012 9.9447 0.244629C10.0754 0.369309 10.1495 0.53891 10.1498 0.716309V1.79639C10.1495 1.97386 10.0755 2.14332 9.9447 2.26807C9.81397 2.39277 9.6374 2.46321 9.45349 2.46338H9.32458C9.27363 4.44769 8.39337 6.21088 7.01501 7.1001C8.39337 7.98948 9.27363 9.75267 9.32458 11.7368H9.45349C9.6374 11.737 9.81397 11.8074 9.9447 11.9321C10.0755 12.0569 10.1495 12.2263 10.1498 12.4038V13.4839C10.1495 13.6613 10.0754 13.8309 9.9447 13.9556C9.81398 14.0802 9.63733 14.1497 9.45349 14.1499H0.74646C0.562624 14.1497 0.385971 14.0802 0.255249 13.9556C0.124524 13.8309 0.0505006 13.6613 0.0501709 13.4839V12.4038C0.0504178 12.2263 0.124491 12.0569 0.255249 11.9321C0.385984 11.8074 0.562553 11.737 0.74646 11.7368H0.875366C0.926313 9.75301 1.806 7.98963 3.18396 7.1001C1.806 6.21073 0.926311 4.44735 0.875366 2.46338H0.74646C0.562553 2.46321 0.385985 2.39277 0.255249 2.26807C0.124491 2.14332 0.0504176 1.97386 0.0501709 1.79639V0.716309C0.0505008 0.538911 0.124524 0.369309 0.255249 0.244629C0.385971 0.120012 0.562624 0.0504607 0.74646 0.050293H9.45349ZM0.74646 12.187C0.617753 12.1871 0.517176 12.2866 0.516968 12.4038V13.4829C0.516968 13.6 0.617597 13.6996 0.74646 13.6997H9.45349C9.58235 13.6996 9.68298 13.6 9.68298 13.4829V12.4038C9.68277 12.2866 9.5822 12.1871 9.45349 12.187H0.74646ZM1.34314 2.46338C1.39567 4.3005 2.2358 5.96674 3.48669 6.75439L3.74451 6.90088L3.79529 6.93701C3.81028 6.9508 3.82351 6.96653 3.83435 6.98389C3.85618 7.01887 3.86755 7.05901 3.86755 7.1001C3.86755 7.14118 3.85618 7.18132 3.83435 7.21631C3.81251 7.25129 3.78143 7.28024 3.74451 7.29932C2.35261 8.0108 1.3992 9.77642 1.34314 11.7368H8.85681C8.80075 9.77658 7.84733 8.01062 6.45544 7.29932C6.41845 7.28029 6.3875 7.2513 6.3656 7.21631C6.34372 7.18131 6.33142 7.14122 6.33142 7.1001C6.33142 7.05898 6.34372 7.01888 6.3656 6.98389C6.3875 6.94889 6.41845 6.91991 6.45544 6.90088C7.84733 6.18975 8.80076 4.42396 8.85681 2.46338H1.34314ZM3.80017 8.85498C3.8543 8.82854 3.91713 8.82311 3.97498 8.84033C4.03257 8.8576 4.08145 8.89589 4.11072 8.94775C4.14006 8.99995 4.14668 9.06149 4.12927 9.11865C4.1118 9.17581 4.07211 9.224 4.01892 9.25244H4.01794C3.57915 9.47645 3.13627 10.0304 3.13611 10.6489C3.13611 10.7093 3.11067 10.7671 3.06677 10.8091C3.02294 10.8509 2.96372 10.8744 2.90271 10.8745C2.84154 10.8745 2.78161 10.851 2.73767 10.8091C2.69381 10.7671 2.66931 10.7093 2.66931 10.6489C2.66947 9.81104 3.25555 9.13311 3.79919 8.85498H3.80017ZM0.74646 0.500488C0.617597 0.500547 0.516968 0.600146 0.516968 0.717285V1.79639C0.517176 1.91356 0.617752 2.01312 0.74646 2.01318H9.45349C9.5822 2.01312 9.68278 1.91356 9.68298 1.79639V0.717285C9.68298 0.600147 9.58235 0.500548 9.45349 0.500488H0.74646Z" fill={color} stroke={color} strokeWidth="0.1"/>
  </Svg>
);

const ProductListScreen = () => {
  const navigation = useNavigation<StackNavigationProp<RootStackParamList, 'ProductList'>>();
  const [searchText, setSearchText] = useState('');
  const handleSearchTextChange = (text: string) => {
    let i = 0;
    while (i < text.length && text[i] === ' ') i++;
    if (i >= text.length) {
      setSearchText(text);
      return;
    }
    const first = text[i].toUpperCase();
    const transformed = text.slice(0, i) + first + text.slice(i + 1);
    setSearchText(transformed);
  };
  const [isModalVisible, setIsModalVisible] = useState(false);
  const [selectedSortOption, setSelectedSortOption] = useState({
    category: 'Tempo médio de fechamento',
    option: 'Mais recentes primeiro'
  });
  const [sortBy, setSortBy] = useState('Mais recentes primeiro');
  const [sideMenuVisible, setSideMenuVisible] = useState(false);

  const { openModal: openAppModal } = useModal();

  useEffect(() => {
    // Ao entrar na tela, verifica cadastro incompleto e abre modal global
    (async () => {
      const incomplete = await checkIncompleteRegistration();
      if (incomplete) {
        openAppModal('registerNow');
      }
    })();
  }, []);

  // Funções para controlar o modal
  const openModal = () => setIsModalVisible(true);
  const closeModal = () => setIsModalVisible(false);
  
  const handleSortSelection = (category: string, option: string) => {
    setSelectedSortOption({ category, option });
    setSortBy(option);
    closeModal();
  };

  const [fontsLoaded] = useFonts({
    Inter_100Thin,
    Inter_200ExtraLight,
    Inter_300Light,
    Inter_400Regular,
    Inter_500Medium,
    Inter_600SemiBold,
    Inter_700Bold,
    Inter_800ExtraBold,
    Inter_900Black,
  });

  if (!fontsLoaded) {
    return null;
  }

  const products = [
    {
      id: 1,
      title: 'Holding Patrimonial',
      commission: '20%',
      averageTicket: 'R$ 10.000',
      averageClosingTime: '30 Dias',
      image: holdingPatrimonialImage,
    },
    {
      id: 2,
      title: 'Ativos Fundiários',
      commission: '15%',
      averageTicket: 'R$ 6.000',
      averageClosingTime: '21 Dias',
      image: ativosFundiariosImage,
    },
    {
      id: 3,
      title: 'Planejamento Tributário',
      commission: '10%',
      averageTicket: 'R$ 4.000',
      averageClosingTime: '10 Dias',
      image: planejamentoTributarioImage,
    },
  ];

  // Filtragem em tempo real pelo nome do produto
  const normalizedSearch = searchText.trim().toLowerCase();
  const filteredProducts = normalizedSearch.length === 0
    ? products
    : products.filter((p) => p.title.toLowerCase().includes(normalizedSearch));

  // Ordenação baseada na opção selecionada no modal
  const parseNumberOnly = (value: string) => {
    const digits = value.replace(/[^0-9]/g, '');
    return Number(digits);
  };

  const sortedProducts = (() => {
    const list = [...filteredProducts];
    const { category, option } = selectedSortOption;

    if (category === 'Data de adição') {
      if (option === 'Mais antigos primeiro') {
        return list.reverse();
      }
      // 'Mais recentes primeiro' mantém a ordem original
      return list;
    }

    if (category === 'Comissão') {
      return list.sort((a, b) => {
        const av = parseNumberOnly(a.commission);
        const bv = parseNumberOnly(b.commission);
        return option === 'Maior para o menor' ? bv - av : av - bv;
      });
    }

    if (category === 'Ticket médio') {
      return list.sort((a, b) => {
        const av = parseNumberOnly(a.averageTicket);
        const bv = parseNumberOnly(b.averageTicket);
        return option === 'Maior para o menor' ? bv - av : av - bv;
      });
    }

    if (category === 'Tempo médio de fechamento') {
      return list.sort((a, b) => {
        const av = parseNumberOnly(a.averageClosingTime);
        const bv = parseNumberOnly(b.averageClosingTime);
        return option === 'Maior para o menor' ? bv - av : av - bv;
      });
    }

    // Qualquer outra combinação mantém a ordem atual
    return list;
  })();

  const handleProductPress = async (product: any) => {
    // Antes de navegar, verifica se o cadastro está completo
    const incomplete = await checkIncompleteRegistration();
    if (incomplete) {
      openAppModal('registerNow');
      return;
    }
    navigation.navigate(ScreenNames.PresentationScreen, { product });
  };

  // Modal global gerencia conclusão de cadastro; sem necessidade de handler local

  const renderProductCard = (product: any) => (
    <TouchableOpacity 
      key={product.id} 
      style={styles.productCard}
      onPress={() => handleProductPress(product)}
      activeOpacity={0.7}
    >
      <View style={styles.productImageContainer}>
        <Image 
          source={product.image} 
          style={styles.productImage}
          resizeMode="cover"
        />
      </View>
      <View style={styles.productInfo}>
        <Text style={styles.productTitle}>{product.title}</Text>
        <View style={styles.divider} />
        
        <View style={styles.productDetail}>
           <Text style={styles.detailLabel}>Comissão</Text>
           <Text style={styles.detailValue}>{product.commission}</Text>
         </View>
         
         <View style={styles.divider} />
         
         <View style={styles.productDetail}>
           <Text style={styles.detailLabel}>Ticket médio</Text>
           <Text style={styles.detailValue}>{product.averageTicket}</Text>
         </View>
         
         <View style={styles.divider} />
         
         <View style={styles.productDetail}>
           <Text style={styles.detailLabel}>Tempo médio de fechamento</Text>
           <Text style={styles.detailValue}>{product.averageClosingTime}</Text>
         </View>
      </View>
    </TouchableOpacity>
  );

  return (
    <SafeAreaView style={styles.container}>
      <StatusBar barStyle="dark-content" backgroundColor="#fcfcfc" />
      
      {/* Header */}
      <Header 
        title="Produtos (06)"
        notificationCount={6}
        onMenuPress={() => setSideMenuVisible(true)}
      />

      {/* Content */}
      <ScrollView
        style={styles.content}
        contentContainerStyle={{ paddingBottom: Layout.bottomMenuHeight }}
        showsVerticalScrollIndicator={false}
      >
        {/* Filters */}
         <View style={styles.filtersContainer}>
           <View style={styles.sortDropdown}>
             <Text style={styles.sortLabel}>Ordenar por</Text>
             <TouchableOpacity style={styles.sortContainer} onPress={openModal}>
               <Text style={styles.sortSubLabel}>{selectedSortOption.category}:</Text>
               <Text style={styles.sortValue}>{selectedSortOption.option}</Text>
             </TouchableOpacity>
           </View>
           
           <View style={styles.searchContainer}>
            <Svg width={16} height={16} viewBox="0 0 16 16" fill="none" style={styles.searchIcon}>
              <Path d="M15 15L11.6556 11.6556M13.4444 7.22222C13.4444 10.6587 10.6587 13.4444 7.22222 13.4444C3.78578 13.4444 1 10.6587 1 7.22222C1 3.78578 3.78578 1 7.22222 1C10.6587 1 13.4444 3.78578 13.4444 7.22222Z" stroke="#7D8592" strokeWidth={2} strokeLinecap="round" strokeLinejoin="round" />
            </Svg>
           <TextInput
              style={[
                styles.searchInput,
                Platform.select({ web: { outlineStyle: 'none', outlineWidth: 0 } }) as any,
              ]}
              placeholder="pesquise aqui"
              placeholderTextColor="#91929e"
              value={searchText}
              onChangeText={handleSearchTextChange}
            />
           </View>
         </View>

        {/* Products */}
         <View style={styles.productsContainer}>
           {sortedProducts.map((product, index) => (
             <React.Fragment key={product.id}>
               {renderProductCard(product)}
               {index < sortedProducts.length - 1 && (
                 <View style={styles.productDivider} />
               )}
             </React.Fragment>
           ))}
         </View>
      </ScrollView>

      {/* Bottom Navigation */}
      <BottomMenu activeScreen="Products" />

       {/* Modal de Ordenação */}
       <ModalOrderingProducts
         isVisible={isModalVisible}
         onClose={closeModal}
         onSortSelection={handleSortSelection}
         selectedSortOption={selectedSortOption}
       />

       {/* Menu Lateral */}
       <SideMenuScreen
         isVisible={sideMenuVisible}
       onClose={() => setSideMenuVisible(false)}
      />

      {/* Modal de cadastro obrigatório: agora gerenciado globalmente pelo ModalRoot */}
    </SafeAreaView>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#fcfcfc',
  },

  content: {
    flex: 1,
    backgroundColor: '#fcfcfc',
    marginTop: 2,
  },
  filtersContainer: {
    paddingHorizontal: 16,
    paddingTop: 10,
    gap: 15,
    width: '100%',
  },
  sortDropdown: {
    flexDirection: 'column',
    alignItems: 'flex-start',
    width: '100%',
    height: 77,
    gap: 5,
  },
  sortLabel: {
    fontSize: 12,
    fontFamily: 'Inter_500Medium',
    color: '#7d8592',
    lineHeight: 15,
    paddingHorizontal: 5,
    paddingVertical: 0,
  },
  sortContainer: {
    flexDirection: 'column',
    alignItems: 'flex-start',
    alignSelf: 'stretch',
    justifyContent: 'center',
    borderWidth: 1,
    borderColor: '#d8e0f0',
    borderRadius: 8,
    padding: 9,
    gap: 5,
  },
  sortSubLabel: {
    fontSize: 12,
    fontFamily: 'Inter_500Medium',
    color: '#7d8592',
    lineHeight: 15,
  },
  sortValue: {
    fontSize: 14,
    fontFamily: 'Inter_400Regular',
    color: '#3a3f51',
    lineHeight: 17,
  },
  searchContainer: {
    flexDirection: 'row',
    alignItems: 'center',
    borderWidth: 1,
    borderColor: '#d8e0f0',
    borderRadius: 8,
    paddingLeft: 14,
    height: 35,
    gap: 10,
    width: '100%',
  },
  searchIcon: {
    width: 16,
    height: 16,
  },
  searchInput: {
    flex: 1,
    fontSize: 14,
    fontFamily: 'Inter_400Regular',
    color: '#3A3F51',
  },
  productsContainer: {
    paddingHorizontal: 16,
    paddingTop: 17,
    gap: 0,
    width: '100%',
  },
  productCard: {
    flexDirection: 'row',
    gap: 12,
    width: '100%',
  },
  productImageContainer: {
    width: 78,
    height: 135,
  },
  productImage: {
    width: 78,
    height: 135,
    borderRadius: 12,
  },
  productInfo: {
    flex: 1,
    gap: 10,
  },
  productTitle: {
    fontSize: 14,
    fontFamily: 'Inter_600SemiBold',
    color: '#3a3f51',
    lineHeight: 17,
  },
  divider: {
    height: 0.1,
    backgroundColor: '#d8e0f0',
  },
  productDetail: {
    flexDirection: 'row',
    alignItems: 'center',
    justifyContent: 'space-between',
  },

  detailLabel: {
    fontSize: 14,
    fontFamily: 'Inter_400Regular',
    color: '#7d8592',
    lineHeight: 17,
  },
  detailValue: {
    fontSize: 14,
    fontFamily: 'Inter_400Regular',
    color: '#1777CF',
    lineHeight: 17,
  },
  productDivider: {
     width: '100%',
     height: 1,
     backgroundColor: '#d8e0f0',
     marginVertical: 16,
   },

});

export default ProductListScreen;